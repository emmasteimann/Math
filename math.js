!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n="undefined"!=typeof globalThis?globalThis:n||self).math=t()}(this,(function(){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(t)}function t(n,t){return function(n){if(Array.isArray(n))return n}(n)||function(n,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(n)))return;var r=[],e=!0,i=!1,o=void 0;try{for(var u,c=n[Symbol.iterator]();!(e=(u=c.next()).done)&&(r.push(u.value),!t||r.length!==t);e=!0);}catch(n){i=!0,o=n}finally{try{e||null==c.return||c.return()}finally{if(i)throw o}}return r}(n,t)||e(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(n){return function(n){if(Array.isArray(n))return i(n)}(n)||function(n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(n))return Array.from(n)}(n)||e(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(n,t){if(n){if("string"==typeof n)return i(n,t);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(n,t):void 0}}function i(n,t){(null==t||t>n.length)&&(t=n.length);for(var r=0,e=new Array(t);r<t;r++)e[r]=n[r];return e}var o=function(t){switch(t.constructor.name){case"vector":case"matrix":case"segment":case"ray":case"line":case"circle":case"ellipse":case"rect":case"polygon":return t.constructor.name}if("object"===n(t)){if(null!=t.radius)return"circle";if(null!=t.width)return"rect";if(null!=t.x||"number"==typeof t[0])return"vector";if(null!=t[0]&&t[0].length&&("number"==typeof t[0].x||"number"==typeof t[0][0]))return"segment";if(null!=t.vector&&null!=t.origin)return"line"}},u=function(n,t){return t.length===n?t:Array(n).fill(0).map((function(n,r){return t[r]?t[r]:n}))},c=function(n,t){var r=n.length>t.length?n.length:t.length;return[n,t].map((function(n){return u(r,n)}))},a=function(n){var t="".concat(n).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},f=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;if("number"!=typeof n)return n;var r=parseFloat(n.toFixed(t));return a(r)===Math.min(t,a(n))?n:r},s=function(n){return null!=n&&"function"==typeof n[Symbol.iterator]},l=function n(){switch(arguments.length){case void 0:case 0:return Array.from(arguments);case 1:return s(arguments[0])&&"string"!=typeof arguments[0]?n.apply(void 0,r(arguments[0])):[arguments[0]];default:return Array.from(arguments).map((function(t){return s(t)?r(n(t)):t}))}},h=function n(){switch(arguments.length){case void 0:case 0:return Array.from(arguments);case 1:return s(arguments[0])&&"string"!=typeof arguments[0]?n.apply(void 0,r(arguments[0])):[arguments[0]];default:return Array.from(arguments).map((function(t){return s(t)?r(n(t)):t})).reduce((function(n,t){return n.concat(t)}),[])}},p=Object.freeze({__proto__:null,resize:u,resize_up:c,resize_down:function(n,t){var r=n.length>t.length?t.length:n.length;return[n,t].map((function(n){return u(r,n)}))},clean_number:f,semi_flatten_arrays:l,flatten_arrays:h}),v=1e-6,d=180/Math.PI,g=Math.PI/180,y=2*Math.PI,m=Object.freeze({__proto__:null,EPSILON:v,R2D:d,D2R:g,TWO_PI:y}),_=function(){return!0},M=function(n){return n*n},b=function(n,t){return n+(t||0)},x=function(n){return void 0!==n},w=function(n,t){return n&&t},j=function(n){return Math.atan2(n[1],n[0])},A=function(n){return[Math.cos(n),Math.sin(n)]},P=function(n,t){return n===t},O=function(n,t){return Math.abs(n-t)<v},k=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;return n>-t},S=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;return n>t},q=_,I=_,z=k,E=S,N=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;return n>-t&&n<1+t},G=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;return n>t&&n<1-t},F=function(n){return n<-v?0:n},T=function(n){return n<-v?0:n>1.000001?1:n},Z=Object.freeze({__proto__:null,fn_true:_,fn_square:M,fn_add:b,fn_not_undefined:x,fn_and:w,fn_cat:function(n,t){return n.concat(t)},fn_vec2_angle:j,fn_to_vec2:A,fn_equal:P,fn_epsilon_equal:O,include:k,exclude:S,include_l:q,exclude_l:I,include_r:z,exclude_r:E,include_s:N,exclude_s:G,line_limiter:function(n){return n},ray_limiter:F,segment_limiter:T}),C=Object.create(null),D=[1,0,0,1],L=D.concat(0,0),R=function(n){return n[0]*n[3]-n[1]*n[2]},J=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=Math.cos(n),e=Math.sin(n);return[r,e,-e,r,t[0],t[1]]},X=Object.freeze({__proto__:null,identity2x2:D,identity2x3:L,multiply_matrix2_vector2:function(n,t){return[n[0]*t[0]+n[2]*t[1]+n[4],n[1]*t[0]+n[3]*t[1]+n[5]]},multiply_matrix2_line2:function(n,t,r){return{vector:[n[0]*t[0]+n[2]*t[1],n[1]*t[0]+n[3]*t[1]],origin:[n[0]*r[0]+n[2]*r[1]+n[4],n[1]*r[0]+n[3]*r[1]+n[5]]}},multiply_matrices2:function(n,t){return[n[0]*t[0]+n[2]*t[1],n[1]*t[0]+n[3]*t[1],n[0]*t[2]+n[2]*t[3],n[1]*t[2]+n[3]*t[3],n[0]*t[4]+n[2]*t[5]+n[4],n[1]*t[4]+n[3]*t[5]+n[5]]},determinant2:R,invert_matrix2:function(n){var t=R(n);if(!(Math.abs(t)<1e-6||isNaN(t))&&isFinite(n[4])&&isFinite(n[5]))return[n[3]/t,-n[1]/t,-n[2]/t,n[0]/t,(n[2]*n[5]-n[3]*n[4])/t,(n[1]*n[4]-n[0]*n[5])/t]},make_matrix2_translate:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return D.concat(n,t)},make_matrix2_scale:function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0];return[n,0,0,t,n*-r[0]+r[0],t*-r[1]+r[1]]},make_matrix2_rotate:J,make_matrix2_reflect:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=Math.atan2(n[1],n[0]),e=Math.cos(r),i=Math.sin(r),o=Math.cos(-r),u=Math.sin(-r),c=e*o+i*u,a=e*-u+i*o,f=i*o+-e*u,s=i*-u+-e*o,l=t[0]+c*-t[0]+-t[1]*f,h=t[1]+a*-t[0]+-t[1]*s;return[c,a,f,s,l,h]}}),Y=function(n){return Math.sqrt(n.map(M).reduce(b,0))},$=function(n){return n.map(M).reduce(b,0)},B=function(n){var t=Y(n);return 0===t?n:n.map((function(n){return n/t}))},H=function(n,t){return n.map((function(n){return n*t}))},U=function(n,t){return n.map((function(n,r){return n+(t[r]||0)}))},V=function(n,t){return n.map((function(n,r){return n-(t[r]||0)}))},W=function(n,t){return n.map((function(r,e){return n[e]*t[e]})).reduce(b,0)},K=function(n,t){return n.map((function(n,r){return(n+t[r])/2}))},Q=function(){var n=arguments;if(0===arguments.length)return[];var t=arguments[0].length>0?arguments[0].length:0,r=Array(t).fill(0);return Array.from(arguments).forEach((function(n){return r.forEach((function(t,e){r[e]+=n[e]||0}))})),r.map((function(t){return t/n.length}))},nn=function(n,t,r){var e=1-r;return n.map((function(n,i){return n*e+(t[i]||0)*r}))},tn=function(n,t){return n[0]*t[1]-n[1]*t[0]},rn=function(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]},en=function(n,t){var r=n[0]-t[0],e=n[1]-t[1];return Math.sqrt(r*r+e*e)},on=function(n,t){return Math.sqrt(n.map((function(r,e){return Math.pow(n[e]-t[e],2)})).reduce((function(n,t){return n+t}),0))},un=function(n){return n.map((function(n){return-n}))},cn=function(n){return[-n[1],n[0]]},an=function(n){return[n[1],-n[0]]},fn=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;return Math.abs(n.reduce(b,0))<t},sn=function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return 1-Math.abs(W(B(n),B(t)))<r},ln=Object.freeze({__proto__:null,magnitude:Y,mag_squared:$,normalize:B,scale:H,add:U,subtract:V,dot:W,midpoint:K,average:Q,lerp:nn,cross2:tn,cross3:rn,distance2:en,distance3:function(n,t){var r=n[0]-t[0],e=n[1]-t[1],i=n[2]-t[2];return Math.sqrt(r*r+e*e+i*i)},distance:on,flip:un,rotate90:cn,rotate270:an,degenerate:fn,parallel:sn}),hn=Object.freeze([1,0,0,0,1,0,0,0,1]),pn=Object.freeze(hn.concat(0,0,0)),vn=function(n){return pn.map((function(t,r){return Math.abs(t-n[r])<v})).reduce((function(n,t){return n&&t}),!0)},dn=function(n,t){return[n[0]*t[0]+n[3]*t[1]+n[6]*t[2]+n[9],n[1]*t[0]+n[4]*t[1]+n[7]*t[2]+n[10],n[2]*t[0]+n[5]*t[1]+n[8]*t[2]+n[11]]},gn=function(n,t,r){return{vector:[n[0]*t[0]+n[3]*t[1]+n[6]*t[2],n[1]*t[0]+n[4]*t[1]+n[7]*t[2],n[2]*t[0]+n[5]*t[1]+n[8]*t[2]],origin:[n[0]*r[0]+n[3]*r[1]+n[6]*r[2]+n[9],n[1]*r[0]+n[4]*r[1]+n[7]*r[2]+n[10],n[2]*r[0]+n[5]*r[1]+n[8]*r[2]+n[11]]}},yn=function(n,t){return[n[0]*t[0]+n[3]*t[1]+n[6]*t[2],n[1]*t[0]+n[4]*t[1]+n[7]*t[2],n[2]*t[0]+n[5]*t[1]+n[8]*t[2],n[0]*t[3]+n[3]*t[4]+n[6]*t[5],n[1]*t[3]+n[4]*t[4]+n[7]*t[5],n[2]*t[3]+n[5]*t[4]+n[8]*t[5],n[0]*t[6]+n[3]*t[7]+n[6]*t[8],n[1]*t[6]+n[4]*t[7]+n[7]*t[8],n[2]*t[6]+n[5]*t[7]+n[8]*t[8],n[0]*t[9]+n[3]*t[10]+n[6]*t[11]+n[9],n[1]*t[9]+n[4]*t[10]+n[7]*t[11]+n[10],n[2]*t[9]+n[5]*t[10]+n[8]*t[11]+n[11]]},mn=function(n){return n[0]*n[4]*n[8]-n[0]*n[7]*n[5]-n[3]*n[1]*n[8]+n[3]*n[7]*n[2]+n[6]*n[1]*n[5]-n[6]*n[4]*n[2]},_n=function(n){var t=mn(n);if(!(Math.abs(t)<1e-6||isNaN(t))&&isFinite(n[9])&&isFinite(n[10])&&isFinite(n[11])){var r=[n[4]*n[8]-n[7]*n[5],-n[1]*n[8]+n[7]*n[2],n[1]*n[5]-n[4]*n[2],-n[3]*n[8]+n[6]*n[5],n[0]*n[8]-n[6]*n[2],-n[0]*n[5]+n[3]*n[2],n[3]*n[7]-n[6]*n[4],-n[0]*n[7]+n[6]*n[1],n[0]*n[4]-n[3]*n[1],-n[3]*n[7]*n[11]+n[3]*n[8]*n[10]+n[6]*n[4]*n[11]-n[6]*n[5]*n[10]-n[9]*n[4]*n[8]+n[9]*n[5]*n[7],n[0]*n[7]*n[11]-n[0]*n[8]*n[10]-n[6]*n[1]*n[11]+n[6]*n[2]*n[10]+n[9]*n[1]*n[8]-n[9]*n[2]*n[7],-n[0]*n[4]*n[11]+n[0]*n[5]*n[10]+n[3]*n[1]*n[11]-n[3]*n[2]*n[10]-n[9]*n[1]*n[5]+n[9]*n[2]*n[4]],e=1/t;return r.map((function(n){return n*e}))}},Mn=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return hn.concat(n,t,r)},bn=function(n,t,r,e,i){var o=hn.concat([0,1,2].map((function(n){return t[n]||0}))),u=Math.cos(n),c=Math.sin(n);return o[3*r+r]=u,o[3*r+e]=(i?1:-1)*c,o[3*e+r]=(i?-1:1)*c,o[3*e+e]=u,o},xn=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return bn(n,t,1,2,!0)},wn=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return bn(n,t,0,2,!1)},jn=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return bn(n,t,0,1,!0)},An=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],i=u(3,B(r)),o=[0,1,2].map((function(n){return e[n]||0})),c=t(i,3),a=c[0],f=c[1],s=c[2],l=Math.cos(n),h=Math.sin(n),p=Math.sqrt(i[1]*i[1]+i[2]*i[2]),v=Math.abs(p)<1e-6?0:f/p,d=Math.abs(p)<1e-6?1:s/p,g=hn.concat(-o[0],-o[1],-o[2]),y=hn.concat(o[0],o[1],o[2]),m=[1,0,0,0,d,v,0,-v,d,0,0,0],_=[1,0,0,0,d,-v,0,v,d,0,0,0],M=[p,0,a,0,1,0,-a,0,p,0,0,0],b=[p,0,-a,0,1,0,a,0,p,0,0,0],x=[l,h,0,-h,l,0,0,0,1,0,0,0];return yn(y,yn(_,yn(b,yn(x,yn(M,yn(m,g))))))},Pn=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return[n,0,0,0,n,0,0,0,n,n*-t[0]+t[0],n*-t[1]+t[1],n*-t[2]+t[2]]},On=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=Math.atan2(n[1],n[0]),e=Math.cos(r),i=Math.sin(r),o=Math.cos(-r),u=Math.sin(-r),c=e*o+i*u,a=e*-u+i*o,f=i*o+-e*u,s=i*-u+-e*o,l=t[0]+c*-t[0]+-t[1]*f,h=t[1]+a*-t[0]+-t[1]*s;return[c,a,0,f,s,0,0,0,1,l,h,0]},kn=Object.freeze({__proto__:null,identity3x3:hn,identity3x4:pn,is_identity3x4:vn,multiply_matrix3_vector3:dn,multiply_matrix3_line3:gn,multiply_matrices3:yn,determinant3:mn,invert_matrix3:_n,make_matrix3_translate:Mn,make_matrix3_rotateX:xn,make_matrix3_rotateY:wn,make_matrix3_rotateZ:jn,make_matrix3_rotate:An,make_matrix3_scale:Pn,make_matrix3_reflectZ:On}),Sn=function(n,t){return{vector:n||[],origin:t||[]}},qn=function(){if(arguments[0]instanceof C.vector)return arguments[0];var t=h(arguments);return t.length>0&&"object"===n(t[0])&&null!==t[0]&&!isNaN(t[0].x)&&(t=["x","y","z"].map((function(n){return t[0][n]})).filter(x)),t.filter((function(n){return"number"==typeof n}))},In=function(){return l(arguments).map((function(n){return qn(n)}))},zn=function(){if(arguments[0]instanceof C.segment)return arguments[0];var n=l(arguments);return 4===n.length?[[n[0],n[1]],[n[2],n[3]]]:n.map((function(n){return qn(n)}))},En=function(){var n=l(arguments);return 0===n.length?Sn([],[]):n[0]instanceof C.line||n[0]instanceof C.ray||n[0]instanceof C.segment?n[0]:n[0].constructor===Object?Sn(n[0].vector||[],n[0].origin||[]):"number"==typeof n[0]?Sn(qn(n)):Sn.apply(void 0,r(n.map((function(n){return qn(n)}))))},Nn=En,Gn=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return{x:n,y:t,width:r,height:e}},Fn=function(){if(arguments[0]instanceof C.rect)return arguments[0];var t=h(arguments);if(t.length>0&&"object"===n(t[0])&&null!==t[0]&&!isNaN(t[0].width))return Gn.apply(void 0,r(["x","y","width","height"].map((function(n){return t[0][n]})).filter(x)));var e=t.filter((function(n){return"number"==typeof n})),i=e.length<4?[,,].concat(r(e)):e;return Gn.apply(void 0,r(i))},Tn=function(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length,r=new Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];return{radius:n,origin:[].concat(r)}},Zn=function(){if(arguments[0]instanceof C.circle)return arguments[0];var n=In(arguments),t=h(arguments).filter((function(n){return"number"==typeof n}));if(2===arguments.length){if(1===n[1].length)return Tn.apply(void 0,[n[1][0]].concat(r(n[0])));if(1===n[0].length)return Tn.apply(void 0,[n[0][0]].concat(r(n[1])));if(n[0].length>1&&n[1].length>1)return Tn.apply(void 0,[en.apply(void 0,r(n))].concat(r(n[0])))}else switch(t.length){case 0:return Tn(1,0,0,0);case 1:return Tn(t[0],0,0,0);default:return Tn.apply(void 0,[t.pop()].concat(r(t)))}return Tn(1,0,0,0)},Cn=[[0,1,3,4,9,10],[0,1,2,3,4,5,6,7,8,9,10,11],[0,1,2,void 0,3,4,5,void 0,6,7,8,void 0,9,10,11]];[11,7,3].forEach((function(n){return delete Cn[2][n]}));var Dn=function(n){return Cn[n<8?0:n<13?1:2]},Ln=function(){var n=h(arguments),t=r(pn);return Dn(n.length).forEach((function(r,e){null!=n[e]&&(t[r]=n[e])})),t},Rn=Object.freeze({__proto__:null,get_vector:qn,get_vector_of_vectors:In,get_segment:zn,get_line:En,get_ray:Nn,get_rect_params:Gn,get_rect:Fn,get_circle:Zn,get_matrix_3x4:Ln}),Jn=function(n,t){return Array.from(Array(n.length-1)).map((function(r,e){return t(n[0],n[e+1])})).reduce(w,!0)},Xn=function(n,t){return[0,1].map((function(r){return O(n[r],t[r])})).reduce(w,!0)},Yn=function(){var n=Array.from(arguments),t=n.map((function(n){return n.length})).reduce((function(n,t){return n>t?n:t})),r=n.map((function(n){return u(t,n)}));return Array.from(Array(arguments.length-1)).map((function(n,t){return r[0].map((function(n,e){return Math.abs(r[0][e]-r[t+1][e])<v})).reduce(w,!0)})).reduce(w,!0)},$n=Object.freeze({__proto__:null,equivalent_vector2:Xn,equivalent_numbers:function n(){return 0!==arguments.length&&(1===arguments.length&&void 0!==arguments[0]?n.apply(void 0,r(arguments[0])):Jn(arguments,O))},equivalent_vectors:Yn,equivalent:function(){var t=l.apply(void 0,arguments);if(t.length<1)return!1;var e=n(t[0]);if("undefined"===e)return!1;switch(e){case"number":return Jn(t,O);case"boolean":case"string":return Jn(t,P);case"object":return t[0].constructor===Array?Yn.apply(void 0,r(t)):Jn(t,(function(n,t){return JSON.stringify(n)===JSON.stringify(t)}));default:return}}}),Bn=Object.freeze({__proto__:null,sort_points_along_vector2:function(n,t){return n.map((function(n){return{point:n,d:n[0]*t[0]+n[1]*t[1]}})).sort((function(n,t){return n.d-t.d})).map((function(n){return n.point}))}}),Hn=function(n,t,r){for(var e,i=t.map((function(t,e){return{o:t,i:e,d:r(n,t)}})),o=1/0,u=0;u<i.length;u+=1)i[u].d<o&&(e=u,o=i[u].d);return e},Un=function(n,t,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;t=u(n.length,t),r=u(n.length,r);var o=$(n),c=V(r,t),a=W(n,c),f=a/o,s=e(f,i);return U(t,H(n,s))},Vn=function(n,t){var r=n.map((function(n,t,r){return V(r[(t+1)%r.length],n)}));return n.map((function(n,e){return Un(r[e],n,t,T)})).map((function(n,r){return{point:n,i:r,distance:on(n,t)}})).sort((function(n,t){return n.distance-t.distance})).shift()},Wn=function(n,t,r){return U(t,H(B(V(r,t)),n))},Kn=Object.freeze({__proto__:null,smallest_comparison_search:Hn,nearest_point2:function(n,t){var r=Hn(n,t,en);return void 0===r?void 0:t[r]},nearest_point:function(n,t){var r=Hn(n,t,on);return void 0===r?void 0:t[r]},nearest_point_on_line:Un,nearest_point_on_polygon:Vn,nearest_point_on_circle:Wn,nearest_point_on_ellipse:function(){return!1}}),Qn=function(n,t){for(;n<0;)n+=y;for(;t<0;)t+=y;for(;n>y;)n-=y;for(;t>y;)t-=y;var r=t-n;return r>=0?r:y-(n-t)},nt=function(n,t){var r=t[0]*n[0]+t[1]*n[1],e=t[0]*n[1]-t[1]*n[0],i=Math.atan2(e,r);return i<0&&(i+=y),i},tt=function(n,t){var r=n[0]*t[0]+n[1]*t[1],e=n[0]*t[1]-n[1]*t[0],i=Math.atan2(e,r);return i<0&&(i+=y),i},rt=function(n,t){return A(j(n)-nt(n,t)/2)},et=function(n,t){return A(j(n)+tt(n,t)/2)},it=function(n,t,e,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v,u=tn(n,e),c=W(n,e),a=u>-o?[et(n,e)]:[rt(n,e)];a[1]=u>-o?cn(a[0]):an(a[0]);var f=(i[0]-t[0])*e[1]-e[0]*(i[1]-t[1]),s=f/u,l=[n,e].map((function(n){return B(n)})),h=Math.abs(tn.apply(void 0,r(l)))<o,p=h?K(t,i):[t[0]+n[0]*s,t[1]+n[1]*s],d=a.map((function(n){return{vector:n,origin:p}}));return h&&delete d[c>-o?1:0],d},ot=function(){var n=h(arguments),t=n.map((function(n,t){return t})).sort((function(t,r){return n[t]-n[r]}));return t.slice(t.indexOf(0),t.length).concat(t.slice(0,t.indexOf(0)))},ut=function(){var n=h(arguments),t=ot(n).map((function(t){return n[t]}));return t.map((function(n,t,r){return[n,r[(t+1)%r.length]]})).map((function(n){return Qn(n[0],n[1])}))},ct=function(n,t,r){var e=Qn(t,r)/n;return Array.from(Array(n-1)).map((function(n,r){return t+e*(r+1)}))},at=Object.freeze({__proto__:null,is_counter_clockwise_between:function(n,t,r){for(;r<t;)r+=y;for(;n>t;)n-=y;for(;n<t;)n+=y;return n<r},clockwise_angle_radians:function(n,t){for(;n<0;)n+=y;for(;t<0;)t+=y;for(;n>y;)n-=y;for(;t>y;)t-=y;var r=n-t;return r>=0?r:y-(t-n)},counter_clockwise_angle_radians:Qn,clockwise_angle2:nt,counter_clockwise_angle2:tt,clockwise_bisect2:rt,counter_clockwise_bisect2:et,bisect_lines2:it,counter_clockwise_order_radians:ot,counter_clockwise_order2:function(){return ot(In(arguments).map(j))},counter_clockwise_sectors_radians:ut,counter_clockwise_sectors2:function(){return ut(In(arguments).map(j))},counter_clockwise_subsect_radians:ct,counter_clockwise_subsect2:function(n,t,r){var e=Math.atan2(t[1],t[0]),i=Math.atan2(r[1],r[0]);return ct(n,e,i).map(A)}}),ft=function(n,t,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:I,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v,o=V(r,t),u=$(n),c=Math.sqrt(u);if(c<i)return!1;var a=tn(o,n.map((function(n){return n/c}))),f=W(o,n)/u;return Math.abs(a)<i&&e(f,i/c)},st=function(n,t,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:q,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:q,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v,c=tn(B(n),B(r));if(!(Math.abs(c)<u)){var a=tn(n,r),f=-a,s=[e[0]-t[0],e[1]-t[1]],l=[-s[0],-s[1]],h=tn(s,r)/a,p=tn(l,n)/f;return i(h,u/Y(n))&&o(p,u/Y(r))?U(t,H(n,h)):void 0}},lt=function(n,t,r){var e=t[0]-n[0],i=t[1]-n[1],o=r[0]-n[0],u=r[1]-n[1],c=e*(n[0]+t[0])+i*(n[1]+t[1]),a=o*(n[0]+r[0])+u*(n[1]+r[1]),f=2*(e*(r[1]-t[1])-i*(r[0]-t[0]));if(Math.abs(f)<v){var s=Math.min(n[0],t[0],r[0]),l=Math.min(n[1],t[1],r[1]),h=.5*(Math.max(n[0],t[0],r[0])-s),p=.5*(Math.max(n[1],t[1],r[1])-l);return{origin:[s+h,l+p],radius:Math.sqrt(h*h+p*p)}}var d=[(u*c-i*a)/f,(e*a-o*c)/f],g=d[0]-n[0],y=d[1]-n[1];return{origin:d,radius:Math.sqrt(g*g+y*y)}},ht=function(n){return.5*n.map((function(n,t,r){var e=r[(t+1)%r.length];return n[0]*e[1]-e[0]*n[1]})).reduce(b,0)},pt=function(n){var t=1/(6*ht(n));return n.map((function(n,t,r){var e=r[(t+1)%r.length],i=n[0]*e[1]-e[0]*n[1];return[(n[0]+e[0])*i,(n[1]+e[1])*i]})).reduce((function(n,t){return[n[0]+t[0],n[1]+t[1]]}),[0,0]).map((function(n){return n*t}))},vt=function(n){var t=Array(n[0].length).fill(1/0),r=Array(n[0].length).fill(-1/0);n.forEach((function(n){return n.forEach((function(n,e){n<t[e]&&(t[e]=n),n>r[e]&&(r[e]=n)}))}));var e=r.map((function(n,r){return n-t[r]}));return Gn(t[0],t[1],e[0],e[1])},dt=function(n){return Array.from(Array(Math.floor(n))).map((function(t,r){return y*(r/n)}))},gt=function(n,t){return n.map((function(n){return[t*Math.cos(n),t*Math.sin(n)]})).map((function(n){return n.map((function(n){return f(n,14)}))}))},yt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return gt(dt(n),t)},mt=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=Math.PI/n,e=dt(n).map((function(n){return n+r}));return gt(e,t)},_t=function(n,t,r){var e=n.map((function(n,e){return{point:ft(t,r,n,q)?n:null,at_index:e}})).filter((function(n){return null!=n.point})),i=n.map((function(n,e,i){return{point:st(t,r,V(n,i[(e+1)%i.length]),i[(e+1)%i.length],I,G),at_index:e}})).filter((function(n){return null!=n.point}));if(2==i.length){var o=i.slice().sort((function(n,t){return n.at_index-t.at_index})),u=n.slice(o[1].at_index+1).concat(n.slice(0,o[0].at_index+1));u.push(o[0].point),u.push(o[1].point);var c=n.slice(o[0].at_index+1,o[1].at_index+1);return c.push(o[1].point),c.push(o[0].point),[u,c]}if(1==i.length&&1==e.length){e[0].type="v",i[0].type="e";var a=e.concat(i).sort((function(n,t){return n.at_index-t.at_index})),f=n.slice(a[1].at_index+1).concat(n.slice(0,a[0].at_index+1));"e"===a[0].type&&f.push(a[0].point),f.push(a[1].point);var s=n.slice(a[0].at_index+1,a[1].at_index+1);return"e"===a[1].type&&s.push(a[1].point),s.push(a[0].point),[f,s]}if(2==e.length){var l=e.slice().sort((function(n,t){return n.at_index-t.at_index}));return[n.slice(l[1].at_index).concat(n.slice(0,l[0].at_index+1)),n.slice(l[0].at_index,l[1].at_index+1)]}return[n.slice()]},Mt=function(t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v,e=1e4,i=t.slice().sort((function(n,t){return Math.abs(n[1]-t[1])<r?n[0]-t[0]:n[1]-t[1]})),o=[];o.push(i[0]);var u=0,c=0,a=function(){c+=1;var n=o.length-1,t=i.filter((function(t){return!(Math.abs(t[0]-o[n][0])<r&&Math.abs(t[1]-o[n][1])<r)})).map((function(t){for(var r=Math.atan2(o[n][1]-t[1],o[n][0]-t[0]);r<u;)r+=2*Math.PI;return{node:t,angle:r,distance:void 0}})).sort((function(n,t){return n.angle<t.angle?-1:n.angle>t.angle?1:0}));if(0===t.length)return{v:void 0};var e=t[0];if(t=t.filter((function(n){return Math.abs(e.angle-n.angle)<r})).map((function(t){var r=Math.sqrt(Math.pow(o[n][0]-t.node[0],2)+Math.pow(o[n][1]-t.node[1],2));return t.distance=r,t})).sort((function(n,t){return n.distance<t.distance?1:n.distance>t.distance?-1:0})),o.filter((function(n){return n===t[0].node})).length>0)return{v:o};o.push(t[0].node),u=Math.atan2(o[n][1]-t[0].node[1],o[n][0]-t[0].node[0])};do{var f=a();if("object"===n(f))return f.v}while(c<e)},bt=function n(t,r,e){var i=t.map((function(n,t){return{vector:e[t],origin:n}})).map((function(n,t,r){return st(n.vector,n.origin,r[(t+1)%r.length].vector,r[(t+1)%r.length].origin,E,E)})),o=r.map((function(n,t){return Un(n.vector,n.origin,i[t],(function(n){return n}))}));if(3===t.length)return t.map((function(n){return{type:"skeleton",points:[n,i[0]]}})).concat([{type:"perpendicular",points:[o[0],i[0]]}]);var u=i.map((function(n,t){return on(n,o[t])})),c=0;u.forEach((function(n,t){n<u[c]&&(c=t)}));var a=[{type:"skeleton",points:[t[c],i[c]]},{type:"skeleton",points:[t[(c+1)%t.length],i[c]]},{type:"perpendicular",points:[o[c],i[c]]}],f=rt(un(r[(c+r.length-1)%r.length].vector),r[(c+1)%r.length].vector),s=c===t.length-1;return t.splice(c,2,i[c]),r.splice(c,1),e.splice(c,2,f),s&&(t.splice(0,1),e.splice(0,1),r.push(r.shift())),a.concat(n(t,r,e))},xt=function(n){var t=n.map((function(n,t,r){return[n,r[(t+1)%r.length]]})).map((function(n){return{vector:V(n[1],n[0]),origin:n[0]}})),e=n.map((function(n,t,r){return[(t-1+r.length)%r.length,t,(t+1)%r.length].map((function(n){return r[n]}))})).map((function(n){return[V(n[0],n[1]),V(n[2],n[1])]})).map((function(n){return rt.apply(void 0,r(n))}));return bt(r(n),t,e)},wt=Object.freeze({__proto__:null,circumcircle:lt,signed_area:ht,centroid:pt,enclosing_rectangle:vt,make_regular_polygon:yt,make_regular_polygon_side_aligned:mt,make_regular_polygon_inradius:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return yt(n,t/Math.cos(Math.PI/n))},make_regular_polygon_inradius_side_aligned:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return mt(n,t/Math.cos(Math.PI/n))},make_regular_polygon_side_length:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return yt(n,t/2/Math.sin(Math.PI/n))},make_regular_polygon_side_length_side_aligned:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return mt(n,t/2/Math.sin(Math.PI/n))},split_convex_polygon:_t,convex_hull:Mt,straight_skeleton:xt}),jt=function(n){var t=n.vector,r=n.origin,e=Y(t),i=cn(t),o=W(r,i)/e;return o<0?{u:[-i[0]/e,-i[1]/e],d:-o}:{u:[i[0]/e,i[1]/e],d:o}},At=function(n){var t=n.u,r=n.d;return{vector:an(t),origin:H(t,r)}},Pt=function(n,t,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:q,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:v,u=Math.pow(r[0],2)+Math.pow(r[1],2),c=Math.sqrt(u),a=0===c?r:r.map((function(n){return n/c})),f=cn(a),s=V(e,t),l=tn(s,a);if(!(Math.abs(l)>n+o)){var h=Math.sqrt(Math.pow(n,2)-Math.pow(l,2)),p=function(n,r){return t[r]-f[r]*l+a[r]*n},d=Math.abs(n-Math.abs(l))<o?[h].map((function(n){return[n,n].map(p)})):[-h,h].map((function(n){return[n,n].map(p)})),g=d.map((function(n){return n.map((function(n,t){return n-e[t]}))})).map((function(n){return n[0]*r[0]+r[1]*n[1]})).map((function(n){return n/u}));return d.filter((function(n,t){return i(g[t],o)}))}},Ot=function(n){return n<0?-Math.pow(-n,1/3):Math.pow(n,1/3)},kt=Object.freeze({__proto__:null,axiom1:function(n,t){return C.line(B(V.apply(void 0,r(c(t,n)))),n)},axiom2:function(n,t){return C.line(B(cn(V.apply(void 0,r(c(t,n))))),K(n,t))},axiom3:function(n,t,r,e){return it(n,t,r,e).map(C.line)},axiom4:function(n,t){return C.line(cn(B(n)),t)},axiom5:function(n,t,e,i){return(Pt(on(e,i),e,n,t,q)||[]).map((function(n){return C.line(B(cn(V.apply(void 0,r(c(n,i))))),K(i,n))}))},axiom6:function(n,t,r,e,i,o){var u=jt({vector:n,origin:t}),c=jt({vector:r,origin:e});if(Math.abs(1-W(u.u,i)/u.d)<.02)return[];var a=[-u.u[1],u.u[0]],f=[i[0]+u.d*u.u[0]-2*o[0],i[1]+u.d*u.u[1]-2*o[1]],s=[u.d*u.u[0]-i[0],u.d*u.u[1]-i[1]],l=W(o,c.u)-c.d,h=2*W(s,a),p=W(s,s),d=W(U(f,s),a),g=W(f,s),y=W(a,c.u),m=W(s,c.u),_=y,M=l+d*y+m,b=l*h+g*y+d*m,x=l*p+g*m,w=function(n){return[u.d*u.u[0]+n*a[0],u.d*u.u[1]+n*a[1]]},j=0;Math.abs(b)>v&&(j=1),Math.abs(M)>v&&(j=2),Math.abs(_)>v&&(j=3);var A=[];switch(j){case 1:A.push(w(-x/b));break;case 2:var P=Math.pow(b,2)-4*M*x;if(P<-v)break;var O=-b/(2*M);if(P<v){A.push(w(O));break}var k=Math.sqrt(P)/(2*M);A.push(w(O+k),w(O-k));break;case 3:var S=M/_,q=b/_,I=x/_,z=(3*q-Math.pow(S,2))/9,E=(9*S*q-27*I-2*Math.pow(S,3))/54,N=Math.pow(z,3)+Math.pow(E,2),G=-S/3;if(N>0){var F=Math.sqrt(N),T=Ot(E+F),Z=Ot(E-F);A.push(w(G+T+Z));break}if(Math.abs(N)<v){var D=Math.pow(E,1/3);if(isNaN(D))break;A.push(w(G+2*D),w(G-D));break}var L=Math.sqrt(-N),R=Math.atan2(L,E)/3,J=Math.pow(Math.pow(E,2)-N,1/6),X=J*Math.cos(R),Y=J*Math.sin(R);A.push(w(G+2*X),w(G-X-Math.sqrt(3)*Y),w(G-X+Math.sqrt(3)*Y))}return A.map((function(n){return B(V(n,i))})).map((function(n,t){return{u:n,d:W(n,K(A[t],i))}})).map(At).map(C.line)},axiom7:function(n,t,e,i){var o=st(n,t,e,i,q,q);return void 0===o?void 0:C.line(B(cn(V.apply(void 0,r(c(o,i))))),K(i,o))}}),St=function(n){return n>=1?0:n<=-1?Math.PI:Math.acos(n)},qt=function(n,t,r){var e=t[0]-n[0],i=t[1]-n[1],o=e*Math.cos(r)+i*Math.sin(r),u=i*Math.cos(r)-e*Math.sin(r);return[n[0]+o,n[1]+u]},It=function(n,t,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v,o=n<r?n:r,u=n<r?r:n,c=n<r?t:e,a=n<r?e:t,f=[c[0]-a[0],c[1]-a[1]],s=Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2));if(!(s<i)){var l=f.map((function(n,t){return n/s*u+a[t]}));if(Math.abs(u+o-s)<i||Math.abs(u-(o+s))<i)return[l];if(!(s+o<u||u+o<s)){var h=St((o*o-s*s-u*u)/(-2*s*u)),p=qt(a,l,+h),d=qt(a,l,-h);return[p,d]}}},zt=function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v;return n.map((function(n,t,r){return[n,r[(t+1)%r.length]]})).map((function(n){return tn(B(V(n[1],n[0])),V(t,n[0]))})).map((function(n){return r(n,e)})).map((function(n,t,r){return n===r[0]})).reduce((function(n,t){return n&&t}),!0)},Et=function(n){for(var t=1;t<n.length;t+=1)if(!Xn(n[0],n[t]))return[n[0],n[t]]},Nt=function(n,t,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:q,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:v,u=n.map((function(n,t,r){return[n,r[(t+1)%r.length]]})).map((function(n){return st(V(n[1],n[0]),n[0],t,r,e,i,o)})).filter((function(n){return void 0!==n}));switch(u.length){case 0:return;case 1:return[u];default:return Et(u)||[u[0]]}},Gt=function(n,t,e){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:I,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:v,a=Nt(n,t,e,o,u,c);switch(u){case E:i=z;break;case G:i=N;break;default:return a}var f=Nt(n,t,e,N,i,c);if(void 0!==f){var s=Et(f);if(void 0===s)switch(u){case I:return;case E:return zt(n,e,S,c)?f:void 0;case G:return zt(n,U(e,t),S,c)||zt(n,e,S,c)?f:void 0}return zt(n,K.apply(void 0,r(s)),S,c)?s:a}},Ft={polygon:function(n){return[n]},rect:function(n){return[n]},circle:function(n){return[n.radius,n.origin]},line:function(n){return[n.vector,n.origin]},ray:function(n){return[n.vector,n.origin]},segment:function(n){return[n.vector,n.origin]}},Tt={polygon:{line:function(n,t,e,i,o){return Gt.apply(void 0,r(n).concat(r(t),[N,i,o]))},ray:function(n,t,e,i,o){return Gt.apply(void 0,r(n).concat(r(t),[N,i,o]))},segment:function(n,t,e,i,o){return Gt.apply(void 0,r(n).concat(r(t),[N,i,o]))}},circle:{circle:function(n,t,e,i,o){return It.apply(void 0,r(n).concat(r(t),[o]))},line:function(n,t,e,i,o){return Pt.apply(void 0,r(n).concat(r(t),[i,o]))},ray:function(n,t,e,i,o){return Pt.apply(void 0,r(n).concat(r(t),[i,o]))},segment:function(n,t,e,i,o){return Pt.apply(void 0,r(n).concat(r(t),[i,o]))}},line:{polygon:function(n,t,e,i,o){return Gt.apply(void 0,r(t).concat(r(n),[N,e,o]))},circle:function(n,t,e,i,o){return Pt.apply(void 0,r(t).concat(r(n),[e,o]))},line:function(n,t,e,i,o){return st.apply(void 0,r(n).concat(r(t),[e,i,o]))},ray:function(n,t,e,i,o){return st.apply(void 0,r(n).concat(r(t),[e,i,o]))},segment:function(n,t,e,i,o){return st.apply(void 0,r(n).concat(r(t),[e,i,o]))}},ray:{polygon:function(n,t,e,i,o){return Gt.apply(void 0,r(t).concat(r(n),[N,e,o]))},circle:function(n,t,e,i,o){return Pt.apply(void 0,r(t).concat(r(n),[e,o]))},line:function(n,t,e,i,o){return st.apply(void 0,r(t).concat(r(n),[i,e,o]))},ray:function(n,t,e,i,o){return st.apply(void 0,r(n).concat(r(t),[e,i,o]))},segment:function(n,t,e,i,o){return st.apply(void 0,r(n).concat(r(t),[e,i,o]))}},segment:{polygon:function(n,t,e,i,o){return Gt.apply(void 0,r(t).concat(r(n),[N,e,o]))},circle:function(n,t,e,i,o){return Pt.apply(void 0,r(t).concat(r(n),[e,o]))},line:function(n,t,e,i,o){return st.apply(void 0,r(t).concat(r(n),[i,e,o]))},ray:function(n,t,e,i,o){return st.apply(void 0,r(t).concat(r(n),[i,e,o]))},segment:function(n,t,e,i,o){return st.apply(void 0,r(n).concat(r(t),[e,i,o]))}}},Zt={polygon:"polygon",rect:"polygon",circle:"circle",line:"line",ray:"ray",segment:"segment"},Ct={polygon:S,rect:S,circle:S,line:I,ray:E,segment:G},Dt=function(n,t,r){var e=o(n),i=o(t),u=Zt[e],c=Zt[i],a=Ft[e](n),f=Ft[i](t),s=n.domain_function||Ct[e],l=t.domain_function||Ct[i];return Tt[u][c](a,f,s,l,r)},Lt=function(n,t,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:I,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:I,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v,c=tn(n,r),a=-c;if(Math.abs(c)<u)return ft(n,t,e,i,u)||ft(un(n),U(t,n),e,i,u)||ft(r,e,t,o,u)||ft(un(r),U(e,r),t,o,u);var f=[e[0]-t[0],e[1]-t[1]],s=[-f[0],-f[1]],l=tn(f,r)/c,h=tn(s,n)/a;return i(l,u/Y(n))&&o(h,u/Y(r))},Rt=function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;if(zt(n,t[0],e,i))return!0;if(zt(t,n[0],e,i))return!0;for(var o=n.map((function(n,t,r){return[V(r[(t+1)%r.length],n),n]})),u=t.map((function(n,t,r){return[V(r[(t+1)%r.length],n),n]})),c=0;c<o.length;c+=1)for(var a=0;a<u.length;a+=1)if(Lt(o[c][0],o[c][1],u[a][0],u[a][1],r,r,i))return!0;return!1},Jt=function(n,t,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return e(n-en(t,r),i)},Xt={polygon:function(n){return[n]},rect:function(n){return[n]},circle:function(n){return[n.radius,n.origin]},line:function(n){return[n.vector,n.origin]},ray:function(n){return[n.vector,n.origin]},segment:function(n){return[n.vector,n.origin]},vector:function(n){return[n]}},Yt={polygon:{polygon:function(n,t,e,i,o){return Rt.apply(void 0,r(n).concat(r(t),[G,S,o]))},vector:function(n,t,e,i,o){return zt.apply(void 0,r(n).concat(r(t),[e,o]))}},circle:{vector:function(n,t,e,i,o){return Jt.apply(void 0,r(n).concat(r(t),[S,o]))}},line:{line:function(n,t,e,i,o){return Lt.apply(void 0,r(n).concat(r(t),[e,i,o]))},ray:function(n,t,e,i,o){return Lt.apply(void 0,r(n).concat(r(t),[e,i,o]))},segment:function(n,t,e,i,o){return Lt.apply(void 0,r(n).concat(r(t),[e,i,o]))},vector:function(n,t,e,i,o){return ft.apply(void 0,r(n).concat(r(t),[e,o]))}},ray:{line:function(n,t,e,i,o){return Lt.apply(void 0,r(t).concat(r(n),[i,e,o]))},ray:function(n,t,e,i,o){return Lt.apply(void 0,r(n).concat(r(t),[e,i,o]))},segment:function(n,t,e,i,o){return Lt.apply(void 0,r(n).concat(r(t),[e,i,o]))},vector:function(n,t,e,i,o){return ft.apply(void 0,r(n).concat(r(t),[e,o]))}},segment:{line:function(n,t,e,i,o){return Lt.apply(void 0,r(t).concat(r(n),[i,e,o]))},ray:function(n,t,e,i,o){return Lt.apply(void 0,r(t).concat(r(n),[i,e,o]))},segment:function(n,t,e,i,o){return Lt.apply(void 0,r(n).concat(r(t),[e,i,o]))},vector:function(n,t,e,i,o){return ft.apply(void 0,r(n).concat(r(t),[e,o]))}},vector:{polygon:function(n,t,e,i,o){return zt.apply(void 0,r(t).concat(r(n),[i,o]))},circle:function(n,t,e,i,o){return Jt.apply(void 0,r(t).concat(r(n),[S,o]))},line:function(n,t,e,i,o){return ft.apply(void 0,r(t).concat(r(n),[i,o]))},ray:function(n,t,e,i,o){return ft.apply(void 0,r(t).concat(r(n),[i,o]))},segment:function(n,t,e,i,o){return ft.apply(void 0,r(t).concat(r(n),[i,o]))},vector:function(n,t,e,i,o){return Xn.apply(void 0,r(n).concat(r(t),[o]))}}},$t={polygon:"polygon",rect:"polygon",circle:"circle",line:"line",ray:"ray",segment:"segment",vector:"vector"},Bt={polygon:S,rect:S,circle:S,line:I,ray:E,segment:G,vector:I},Ht=function(n,t,r){var e=o(n),i=o(t),u=$t[e],c=$t[i],a=Xt[e](n),f=Xt[i](t),s=n.domain_function||Bt[e],l=t.domain_function||Bt[i];return Yt[u][c](a,f,s,l,r)},Ut=function(n,t,r){return U(t,H(n,r))},Vt=function(n,t,r,e,i){var o=n.map((function(n,t,r){return[V(r[(t+1)%r.length],n),n]})).map((function(n){return function(n,t,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:N,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:v,u=tn(B(n),B(r));if(!(Math.abs(u)<o)){var c=tn(n,r),a=-c,f=V(e,t),s=un(f),l=tn(f,r)/c;return i(tn(s,n)/a,o/Y(r))?l:void 0}}(t,r,n[0],n[1],e,i)})).filter(x).sort((function(n,t){return n-t}));if(!(o.length<2)){var u=[o[0],o[o.length-1]];return u[1]-u[0]>i*Y(t)?u:void 0}},Wt=function(n,t,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:q,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:v,u=Vt(n,t,r,N,o);if(void 0!==u){var c=u.map((function(n,t){return i(n)?n:n<.5?0:1}));if(!(Math.abs(c[0]-c[1])<o)){var a=Ut(t,r,(c[0]+c[1])/2);return zt(n,a,e,o)?c.map((function(n){return Ut(t,r,n)})):void 0}}},Kt={preserve:{magnitude:function(){return Y(this)},isEquivalent:function(){return Yn(this,qn(arguments))},isParallel:function(){return sn.apply(void 0,r(c(this,qn(arguments))))},isCollinear:function(n){return Ht(this,n)},dot:function(){return W.apply(void 0,r(c(this,qn(arguments))))},distanceTo:function(){return on.apply(void 0,r(c(this,qn(arguments))))},overlap:function(n){return Ht(this,n)}},vector:{copy:function(){return r(this)},normalize:function(){return B(this)},scale:function(){return H(this,arguments[0])},flip:function(){return un(this)},rotate90:function(){return cn(this)},rotate270:function(){return an(this)},cross:function(){return rn(u(3,this),u(3,qn(arguments)))},transform:function(){return dn(Ln(arguments),u(3,this))},add:function(){return U(this,u(this.length,qn(arguments)))},subtract:function(){return V(this,u(this.length,qn(arguments)))},rotateZ:function(n,t){return dn(Ln(J(n,t)),u(3,this))},lerp:function(n,t){return nn(this,u(this.length,qn(n)),t)},midpoint:function(){return K.apply(void 0,r(c(this,qn(arguments))))},bisect:function(){return et(this,qn(arguments))}}},Qt={};Object.keys(Kt.preserve).forEach((function(n){Qt[n]=Kt.preserve[n]})),Object.keys(Kt.vector).forEach((function(n){Qt[n]=function(){return C.vector.apply(C,r(Kt.vector[n].apply(this,arguments)))}}));var nr={fromAngle:function(n){return C.vector(Math.cos(n),Math.sin(n))},fromAngleDegrees:function(n){return C.vector.fromAngle(n*g)}},tr={vector:{P:Array.prototype,A:function(){this.push.apply(this,r(qn(arguments)))},G:{x:function(){return this[0]},y:function(){return this[1]},z:function(){return this[2]}},M:Qt,S:nr}},rr={fromPoints:function(){var n=In(arguments);return this.constructor({vector:V(n[1],n[0]),origin:n[0]})},fromAngle:function(){var n=arguments[0]||0;return this.constructor({vector:[Math.cos(n),Math.sin(n)],origin:[0,0]})},perpendicularBisector:function(){var n=In(arguments);return this.constructor({vector:cn(V(n[1],n[0])),origin:Q(n[0],n[1])})}},er={isParallel:function(){var n=c(this.vector,En.apply(void 0,arguments).vector);return sn.apply(void 0,r(n))},isCollinear:function(){var n=En(arguments);return ft(this.vector,this.origin,n.origin)&&sn.apply(void 0,r(c(this.vector,n.vector)))},isDegenerate:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v;return fn(this.vector,n)},reflectionMatrix:function(){return C.matrix(On(this.vector,this.origin))},nearestPoint:function(){var n=qn(arguments);return C.vector(Un(this.vector,this.origin,n,this.clip_function))},transform:function(){var n=this.dimension,t=gn(Ln(arguments),u(3,this.vector),u(3,this.origin));return this.constructor(u(n,t.vector),u(n,t.origin))},translate:function(){var n=U.apply(void 0,r(c(this.origin,qn(arguments))));return this.constructor(this.vector,n)},intersect:function(){return Dt.apply(void 0,[this].concat(Array.prototype.slice.call(arguments)))},overlap:function(){return Ht.apply(void 0,[this].concat(Array.prototype.slice.call(arguments)))},bisect:function(n,t){var r=this,e=En(n);return it(this.vector,this.origin,e.vector,e.origin,t).map((function(n){return r.constructor(n)}))}},ir={line:{P:Object.prototype,A:function(){var n=En.apply(void 0,arguments);this.vector=C.vector(n.vector),this.origin=C.vector(u(this.vector.length,n.origin)),Object.defineProperty(this,"domain_function",{writable:!0,value:q})},G:{dimension:function(){return[this.vector,this.origin].map((function(n){return n.length})).reduce((function(n,t){return Math.max(n,t)}),0)}},M:Object.assign({},er,{inclusive:function(){return this.domain_function=q,this},exclusive:function(){return this.domain_function=I,this},clip_function:function(n){return n},svgPath:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e4,t=U(this.origin,H(this.vector,-n/2)),r=H(this.vector,n);return"M".concat(t[0]," ").concat(t[1],"l").concat(r[0]," ").concat(r[1])}}),S:rr}},or={ray:{P:Object.prototype,A:function(){var n=En.apply(void 0,arguments);this.vector=C.vector(n.vector),this.origin=C.vector(u(this.vector.length,n.origin)),Object.defineProperty(this,"domain_function",{writable:!0,value:z})},G:{dimension:function(){return[this.vector,this.origin].map((function(n){return n.length})).reduce((function(n,t){return Math.max(n,t)}),0)}},M:Object.assign({},er,{inclusive:function(){return this.domain_function=z,this},exclusive:function(){return this.domain_function=E,this},flip:function(){return C.ray(un(this.vector),this.origin)},scale:function(n){return C.ray(this.vector.scale(n),this.origin)},normalize:function(){return C.ray(this.vector.normalize(),this.origin)},clip_function:F,svgPath:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,t=this.vector.scale(n);return"M".concat(this.origin[0]," ").concat(this.origin[1],"l").concat(t[0]," ").concat(t[1])}}),S:rr}},ur={segment:{P:Array.prototype,A:function(){var n=zn.apply(void 0,arguments);this.push.apply(this,r([n[0],n[1]].map((function(n){return C.vector(n)})))),this.vector=C.vector(V(this[1],this[0])),this.origin=this[0],Object.defineProperty(this,"domain_function",{writable:!0,value:N})},G:{points:function(){return this},magnitude:function(){return Y(this.vector)},dimension:function(){return[this.vector,this.origin].map((function(n){return n.length})).reduce((function(n,t){return Math.max(n,t)}),0)}},M:Object.assign({},er,{inclusive:function(){return this.domain_function=N,this},exclusive:function(){return this.domain_function=G,this},clip_function:T,transform:function(){for(var n=this.points[0].length,t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];var i=Ln(r),o=this.points.map((function(n){return u(3,n)})).map((function(n){return dn(i,n)})).map((function(t){return u(n,t)}));return C.segment(o)},translate:function(){var n=qn(arguments),t=this.points.map((function(t){return U.apply(void 0,r(c(t,n)))}));return C.segment(t)},midpoint:function(){return C.vector(Q(this.points[0],this.points[1]))},svgPath:function(){var n=this.points.map((function(n){return"".concat(n[0]," ").concat(n[1])}));return["M","L"].map((function(t,r){return"".concat(t).concat(n[r])})).join("")}}),S:{fromPoints:function(){return this.constructor.apply(this,arguments)}}}},cr=function(n,t,r,e,i,o){var u=Math.cos(i),c=Math.sin(i),a=Math.cos(o),f=Math.sin(o);return[n+u*r*a+-c*e*f,t+c*r*a+u*e*f]},ar=function(n,t,r,e,i,o,u){var c=o;if(c<0&&!isNaN(c))for(;c<0;)c+=2*Math.PI;var a=u>2*Math.PI?2*Math.PI:u,f=cr(n,t,r,e,i,c),s=cr(n,t,r,e,i,c+a/2),l=cr(n,t,r,e,i,c+a),h=a/2>Math.PI?1:0,p=a/2>0?1:0;return{x1:f[0],y1:f[1],x2:s[0],y2:s[1],x3:l[0],y3:l[1],fa:h,fs:p}},fr=function(n){return f(n,4)},sr=function(n,t,r,e,i,o,u){return"A".concat(fr(n)," ").concat(fr(t)," ").concat(fr(r)," ").concat(fr(e)," ").concat(fr(i)," ").concat(fr(o)," ").concat(fr(u))},lr={circle:{A:function(){var n=Zn.apply(void 0,arguments);this.radius=n.radius,this.origin=C.vector.apply(C,r(n.origin))},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]},z:function(){return this.origin[2]}},M:{nearestPoint:function(){return C.vector(Wn(this.radius,this.origin,qn(arguments)))},intersect:function(n){return Dt(this,n)},overlap:function(n){return Ht(this,n)},svgPath:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2*Math.PI,r=ar(this.origin[0],this.origin[1],this.radius,this.radius,0,n,t),e=sr(this.radius,this.radius,0,r.fa,r.fs,r.x2,r.y2),i=sr(this.radius,this.radius,0,r.fa,r.fs,r.x3,r.y3);return"M".concat(r.x1," ").concat(r.y1).concat(e).concat(i)},points:function(){var n=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;return Array.from(Array(t)).map((function(n,r){return 2*Math.PI/t*r})).map((function(t){return[n.origin[0]+n.radius*Math.cos(t),n.origin[1]+n.radius*Math.sin(t)]}))},polygon:function(){return C.polygon(this.points(arguments[0]))},segments:function(){var n=this.points(arguments[0]);return n.map((function(t,r){var e=(r+1)%n.length;return[t,n[e]]}))}},S:{fromPoints:function(){if(3===arguments.length){var n=lt.apply(void 0,arguments);return this.constructor(n.radius,n.origin)}return this.constructor.apply(this,arguments)},fromThreePoints:function(){var n=lt.apply(void 0,arguments);return this.constructor(n.radius,n.origin)}}}},hr=function(n,t,r,e){var i=t>r,o=i?Math.pow(t,2)-Math.pow(r,2):Math.pow(r,2)-Math.pow(t,2),u=Math.sqrt(o),c=i?Math.cos(e):Math.sin(e),a=i?Math.sin(e):Math.cos(e);return[C.vector(n[0]+u*c,n[1]+u*a),C.vector(n[0]-u*c,n[1]-u*a)]},pr={ellipse:{A:function(){var n=h(arguments).filter((function(n){return!isNaN(n)})),t=u(5,n);this.rx=t[0],this.ry=t[1],this.origin=C.vector(t[2],t[3]),this.spin=t[4],this.foci=hr(this.origin,this.rx,this.ry,this.spin)},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]}},M:{svgPath:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2*Math.PI,r=ar(this.origin[0],this.origin[1],this.rx,this.ry,this.spin,n,t),e=sr(this.rx,this.ry,this.spin/Math.PI*180,r.fa,r.fs,r.x2,r.y2),i=sr(this.rx,this.ry,this.spin/Math.PI*180,r.fa,r.fs,r.x3,r.y3);return"M".concat(r.x1," ").concat(r.y1).concat(e).concat(i)},points:function(){var n=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;return Array.from(Array(t)).map((function(n,r){return 2*Math.PI/t*r})).map((function(t){return cr(n.origin.x,n.origin.y,n.rx,n.ry,n.spin,t)}))},polygon:function(){return C.polygon(this.points(arguments[0]))},segments:function(){var n=this.points(arguments[0]);return n.map((function(t,r){var e=(r+1)%n.length;return[t,n[e]]}))}},S:{}}},vr={area:function(){return ht(this)},centroid:function(){return C.vector(pt(this))},enclosingRectangle:function(){return C.rect(vt(this))},straightSkeleton:function(){return xt(this)},scale:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pt(this),r=this.map((function(n){return[0,1].map((function(r,e){return n[e]-t[e]}))})).map((function(r){return r.map((function(e,i){return t[i]+r[i]*n}))}));return this.constructor.fromPoints(r)},rotate:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pt(this),r=this.map((function(r){var e=[r[0]-t[0],r[1]-t[1]],i=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),o=Math.atan2(e[1],e[0]);return[t[0]+Math.cos(o+n)*i,t[1]+Math.sin(o+n)*i]}));return C.polygon(r)},translate:function(){var n=qn.apply(void 0,arguments),t=this.map((function(t){return t.map((function(t,r){return t+n[r]}))}));return this.constructor.fromPoints(t)},transform:function(){var n=Ln.apply(void 0,arguments),t=this.map((function(t){return dn(n,u(3,t))}));return C.polygon(t)},nearest:function(){var n=qn.apply(void 0,arguments),t=Vn(this,n);return void 0===t?void 0:Object.assign(t,{edge:this.sides[t.i]})},split:function(){var n=En.apply(void 0,arguments),t=_t;return t(this,n.vector,n.origin).map((function(n){return C.polygon(n)}))},overlap:function(){return Ht.apply(void 0,[this].concat(Array.prototype.slice.call(arguments)))},intersect:function(){return Dt.apply(void 0,[this].concat(Array.prototype.slice.call(arguments)))},clip:function(n,t){var r=n.domain_function?n.domain_function:include_l,e=Wt(this,n.vector,n.origin,this.domain_function,r,t);return e?C.segment(e):void 0},svgPath:function(){var n=Array(this.length).fill("L");return n[0]="M","".concat(this.map((function(t,r){return"".concat(n[r]).concat(t[0]," ").concat(t[1])})).join(""),"z")}},dr=function(n){return[[n.x,n.y],[n.x+n.width,n.y],[n.x+n.width,n.y+n.height],[n.x,n.y+n.height]]},gr={rect:{P:Array.prototype,A:function(){var n=Fn.apply(void 0,arguments);this.width=n.width,this.height=n.height,this.origin=C.vector(n.x,n.y),this.push.apply(this,r(dr(this))),Object.defineProperty(this,"domain_function",{writable:!0,value:k})},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]},center:function(){return C.vector(this.origin[0]+this.width/2,this.origin[1]+this.height/2)}},M:Object.assign({},vr,{inclusive:function(){return this.domain_function=k,this},exclusive:function(){return this.domain_function=S,this},area:function(){return this.width*this.height},segments:function(){return[[[(n=this).x,n.y],[n.x+n.width,n.y]],[[n.x+n.width,n.y],[n.x+n.width,n.y+n.height]],[[n.x+n.width,n.y+n.height],[n.x,n.y+n.height]],[[n.x,n.y+n.height],[n.x,n.y]]];var n},svgPath:function(){return"M".concat(this.origin.join(" "),"h").concat(this.width,"v").concat(this.height,"h").concat(-this.width,"Z")}}),S:{fromPoints:function(){return C.rect(vt(In(arguments)))}}}},yr={polygon:{P:Array.prototype,A:function(){this.push.apply(this,r(l(arguments))),this.sides=this.map((function(n,t,r){return[n,r[(t+1)%r.length]]})),this.vectors=this.sides.map((function(n){return V(n[1],n[0])})),Object.defineProperty(this,"domain_function",{writable:!0,value:k})},G:{isConvex:function(){return!0},points:function(){return this}},M:Object.assign({},vr,{inclusive:function(){return this.domain_function=k,this},exclusive:function(){return this.domain_function=S,this},segments:function(){return this.sides}}),S:{fromPoints:function(){return this.constructor.apply(this,arguments)},regularPolygon:function(){return this.constructor(yt.apply(void 0,arguments))},convexHull:function(){return this.constructor(Mt.apply(void 0,arguments))}}}},mr=function(n,t){for(var r=0;r<12;r+=1)n[r]=t[r];return n},_r={matrix:{P:Array.prototype,A:function(){var n=this;Ln(arguments).forEach((function(t){return n.push(t)}))},G:{},M:{copy:function(){return C.matrix.apply(C,r(Array.from(this)))},set:function(){return mr(this,Ln(arguments))},isIdentity:function(){return vn(this)},multiply:function(n){return mr(this,yn(this,n))},determinant:function(){return mn(this)},inverse:function(){return mr(this,_n(this))},translate:function(n,t,r){return mr(this,yn(this,Mn(n,t,r)))},rotateX:function(n){return mr(this,yn(this,xn(n)))},rotateY:function(n){return mr(this,yn(this,wn(n)))},rotateZ:function(n){return mr(this,yn(this,jn(n)))},rotate:function(n,t,r){var e=An(n,t,r);return mr(this,yn(this,e))},scale:function(n){return mr(this,yn(this,Pn(n)))},reflectZ:function(n,t){var r=On(n,t);return mr(this,yn(this,r))},transform:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return C.vector(dn(this,u(3,qn(t))))},transformVector:function(n){return C.vector(dn(this,u(3,qn(n))))},transformLine:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var e=En(t);return C.line(gn(this,e.vector,e.origin))}},S:{}}},Mr=Object.assign({},tr,ir,or,ur,lr,pr,gr,yr,_r),br=function(n,t){var r=Object.create(Mr[n].proto);return Mr[n].A.apply(r,t),r};Object.assign(C,{vector:function(){return br("vector",arguments)},circle:function(){return br("circle",arguments)},ellipse:function(){return br("ellipse",arguments)},rect:function(){return br("rect",arguments)},polygon:function(){return br("polygon",arguments)},line:function(){return br("line",arguments)},ray:function(){return br("ray",arguments)},segment:function(){return br("segment",arguments)},matrix:function(){return br("matrix",arguments)}}),Object.keys(Mr).forEach((function(n){var t={};t.prototype=null!=Mr[n].P?Object.create(Mr[n].P):Object.create(Object.prototype),t.prototype.constructor=t,C[n].prototype=t.prototype,C[n].prototype.constructor=C[n],Object.keys(Mr[n].G).forEach((function(r){return Object.defineProperty(t.prototype,r,{get:Mr[n].G[r]})})),Object.keys(Mr[n].M).forEach((function(r){return Object.defineProperty(t.prototype,r,{value:Mr[n].M[r]})})),Object.keys(Mr[n].S).forEach((function(t){return Object.defineProperty(C[n],t,{value:Mr[n].S[t].bind(C[n].prototype)})})),Mr[n].proto=t.prototype}));var xr=C;return xr.core=Object.assign(Object.create(null),m,p,Rn,Z,ln,$n,Bn,wt,at,X,kn,Kn,kt,{enclose_convex_polygons_inclusive:function(n,t){var r=n.map((function(n){return zt(t,n,k)})).reduce((function(n,t){return n||t}),!1),e=t.map((function(n){return zt(t,n,k)})).reduce((function(n,t){return n&&t}),!0);return!r&&e},intersect_convex_polygon_line:Gt,intersect_circle_circle:It,intersect_circle_line:Pt,intersect_line_line:st,overlap_convex_polygons:Rt,overlap_convex_polygon_point:zt,overlap_line_line:Lt,overlap_line_point:ft,clip_line_in_convex_polygon:Wt}),xr.typeof=o,xr.intersect=Dt,xr.overlap=Ht,xr}));
